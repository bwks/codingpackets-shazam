



<!DOCTYPE html>
<html lang="en" class="dark scroll-smooth scroll-pt-[4.5rem]">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    
      <link rel="shortcut icon" href="/favicon/favicon.ico" type="image/x-icon">
    
    
    
      <link rel="stylesheet" href="/css/highlightjs/tokyo-night-dark.min.css">
      <link rel="stylesheet" href="/css/fontawesome/css/all.min.css">
    

    
      <link rel="stylesheet" href="/css/app.css">
    

    
      <script src="/js/highlightjs/highlightjs-11.7.0.min.js"></script>
      <script src="/js/highlightjs/terraform.js"></script>
      <script defer src="/js/fontawesome/js/all.js"></script>
    

    
      <script defer src="/js/custom/back-to-top.js"></script>
      <script defer src="/js/custom/light-switch.js"></script>
    

    
      <script>
        hljs.registerLanguage('terraform', window.hljsDefineTerraform);
        hljs.highlightAll();
      </script>
    

    
    

    <title>codingpackets.com</title>
  </head>

  <body class="bg-stone-50 dark:bg-black tracking-wide">

    <!-- NAVBAR START -->
<nav id="navbar" class="w-full py-3 bg-zinc-900 text-xl shadow-lg fixed inset-x-0 top-0 z-50">
  <div class="flex justify-center items-center py-1">
    <div>
      <a class="text-neutral-400 hover:text-neutral-100 p-0" href="/">Me</a>
    </div>
    <div class="px-4">
      <p class="text-neutral-400 p-0">|</p>
    </div>
    <div>
      <a class="text-neutral-400 hover:text-neutral-100" href="/blog/">Blog</a>
    </div>
    <div class="px-4">
      <p class="text-neutral-400 p-0">|</p>
    </div>
    <div>
      <a class="text-neutral-400 hover:text-neutral-100" href="/blog/recent/">Recent</a>
    </div>
    <div class="px-4">
      <p class="text-neutral-400 p-0">|</p>
    </div>
    <div class="-mt-6 -ml-1">
      <labeL class="relative inline-block">
        <input type="checkbox" id="light-switch" class="opacity-0 w-0 h-0">
        <img id="light-bulb" class="opacity-90 hover:opacity-60 dark:opacity-60 dark:hover:opacity-100 p-0 w-7" src="/img/light-bulb-64-light.png" alt="on/off">
      </labeL>
    </div>
  </div>  
</nav>
<!-- NAVBAR END -->

    <div class="w-full">
      
  
    
<!-- PAGE HEADER START -->
<div class="grid grid-cols-12 gap-8">
  <div class="invisible md:visible md:col-span-3">
  </div>

  <div class="col-span-12 px-5 md:col-span-6">
    <div id="page-header" class="text-center md:pt-20 md:pb-4 md:mb-0 pt-12 pb-0 -mb-12">
      <h1 class="pb-1 md:pb-2">Salt Overview</h1>
      
        <p class="text-neutral-500 dark:text-neutral-600 text-lg italic py-0">
          updated: 7th of April 2019
        </p>
      
      
        <p class="text-neutral-500 dark:text-neutral-600 text-lg italic py-0">
          published: 7th of January 2018
        </p>
      
    </div>
  </div>

  <div class="invisible md:visible md:col-span-3">
  </div>
</div>
<!-- PAGE HEADER END -->

  


      <!-- CONTENT START -->
      <div class="grid grid-cols-12 gap-8">

        <!-- COLUMN 1 START -->
        <div class="invisible md:visible md:col-span-3">
        </div>
        <!-- COLUMN 1 END -->

        <!-- COLUMN 2 START -->
        <div class="col-span-12 px-5 md:col-span-6">
          <div class="text-xl text-gray-800 dark:text-neutral-400 font-medium leading-relaxed md:leading-relaxed">
            
  <h3 id="overview">Overview</h3>
  <p>
    <a class="break-words text-sky-600 no-underline hover:text-sky-900" href="https://saltstack.com/salt-open-source/" target=_blank>Salt</a>
 is open source software for infrastructure automation.
    Salt was initially an agent based system but the team have since implemented an ssh based connector for
    devices that do not support or have the ability to install an agent. This agent/agentless feature give
    you the ability to manage servers as well as network devices which makes it a great tool for network automation.
  </p>
  <p>
    There is also an enterprise based system know as <a class="break-words text-sky-600 no-underline hover:text-sky-900" href="https://saltstack.com/" target=_blank>SaltStack</a>
 that offers
    enterprise features like a GUI, RBAC and 24/7 support.
  </p>

  <h3 id="architecture">Architecture</h3>

  
<!-- IMAGE START -->
<div class="pt-4 pb-6 flex justify-center">
  <img class="bg-white rounded-lg shadow-md shadow-zinc-400 dark:opacity-80 dark:shadow-none" 
     height="400px"
    src="/img/blog/salt-overview/salt-architecture.svg" alt="blog/salt-overview/salt-architecture.svg">
</div>
<!-- IMAGE END -->


  <ul>
    <li><b>Salt Master</b> - Controls minions</li>
    <li><b>Salt Minion</b> - Executes code from the master via an agent</li>
    <li><b>Salt Proxy Monion</b> - Executes code on hosts that cannot install an agent</li>
    <li><b>Message Bus</b> - Messages between Salt master and minions are sent along the message bus</li>
  </ul>

  <h3 id="topologies">Topologies</h3>
  <p>
    There are a number of logical topologies that can be created with a Salt infrastructure.
  </p>
  <ul>
    <li><b>Master / Minion</b> - One or more masters control minions.</li>
    <li><b>Master of Masters</b> - Heirachical topology where higher level masters control subordinate masters.</li>
    <li><b>Masterless</b> - Configuration management for a single minion without the use of a master.</li>
    <li><b>Salt SSH</b> - Salt is run over SSH without a minion daemon.</li>
  </ul>

  <p>
    A detailed run down of the logical topologies can be found in the
    <a class="break-words text-sky-600 no-underline hover:text-sky-900" href="https://docs.saltstack.com/en/latest/topics/topology/" target=_blank>documentation</a>
.
  </p>

  <h3 id="install">Install</h3>
  <p>
    The recommended method to install Salt is via the Salt maintained repositories. To install
    Salt in this manner requires a couple of steps.
  </p>
  <ul>
    <li>Add Salt GPG key</li>
    <li>Add Salt repositroy</li>
    <li>Update YUM/APT cache</li>
    <li>Install required daemons</li>
  </ul>

  <h4><b>Centos 7</b></h4>
  <p>
    As the root user or user with sudo privileges.
  </p>


  
<!-- CODE BLOCK START -->
<div id="code-block" class="py-2">
  <div class="border-4 rounded-t-lg border-b-4 py-1 text-center font-bold font-mono border-zinc-800 dark:bg-[#1a1b26]">
    <span class="">cmd</span>
  </div>
  <div class="font-mono leading-tight">
    <pre class=""><code class="language-text hljs px-5 border-b-4 border-l-4 border-r-4 border-zinc-800 rounded-b-lg"># RHEL/Centos</span>

sudo yum install https://repo.saltstack.com/yum/redhat/salt-repo-latest-2.el7.noarch.rpm
sudo yum clean expire-cache</code></pre>
  </div>
</div>
<!-- CODE BLOCK END -->



  <h4><b>Ubuntu 1604</b></h4>

  
<!-- CODE BLOCK START -->
<div id="code-block" class="py-2">
  <div class="border-4 rounded-t-lg border-b-4 py-1 text-center font-bold font-mono border-zinc-800 dark:bg-[#1a1b26]">
    <span class="">cmd</span>
  </div>
  <div class="font-mono leading-tight">
    <pre class=""><code class="language-text hljs px-5 border-b-4 border-l-4 border-r-4 border-zinc-800 rounded-b-lg"># Debian

wget -O - https://repo.saltstack.com/apt/ubuntu/16.04/amd64/latest/SALTSTACK-GPG-KEY.pub | sudo apt-key add -
deb http://repo.saltstack.com/apt/ubuntu/16.04/amd64/latest xenial main
sudo apt-get update</code></pre>
  </div>
</div>
<!-- CODE BLOCK END -->


  <p>
    Install <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">salt-daemons</span>
 as required.
  </p>

  
<!-- CODE BLOCK START -->
<div id="code-block" class="py-2">
  <div class="border-4 rounded-t-lg border-b-4 py-1 text-center font-bold font-mono border-zinc-800 dark:bg-[#1a1b26]">
    <span class="">cmd</span>
  </div>
  <div class="font-mono leading-tight">
    <pre class=""><code class="language-text hljs px-5 border-b-4 border-l-4 border-r-4 border-zinc-800 rounded-b-lg"># RHEL/Centos

# Masters optionally have a salt-minion daemon

yum install -y salt-master

# Minions

yum install -y salt-minion</code></pre>
  </div>
</div>
<!-- CODE BLOCK END -->


  
<!-- NOTE BLOCK START -->
<div id="note-block" class="pt-2 pb-4">
  <div class="shadow-md shadow-zinc-400 bg-sky-100 rounded border-l-8 border-l-sky-900 dark:border-l-sky-600 dark:bg-sky-800 dark:shadow-none">
    <div class="px-4 pt-4 pb-2 text-sky-900 dark:text-zinc-900"><i class="far fa-check-circle" aria-hidden="true"></i><b class="pl-1.5">Note</b></div>
    <div class="px-4 pb-4 dark:text-zinc-900">
      Replace <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">yum</span> for <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">apt</span> on Debian based systems
  </div>
  </div>
</div>
<!-- NOTE BLOCK END -->


  <p>
    See the official <a class="break-words text-sky-600 no-underline hover:text-sky-900" href="https://repo.saltstack.com/" target=_blank>documentation</a>
 for info on how to install salt on
    other platforms.
  </p>

  <h3 id="configuration">Configuration</h3>
  <p>
    Salt's configuration files are defined in YAML and located in the
    <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">/etc/salt/</span>
 directory.
    Each daemon has its own configuration file. For example <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">/etc/salt/master</span>

    is the <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">salt-master</span>
 daemons configuration file.
  </p>
  <h4><b>Example Configuration Files</b></h4>
  <p>Master</p>


  
<!-- CODE BLOCK START -->
<div id="code-block" class="py-2">
  <div class="border-4 rounded-t-lg border-b-4 py-1 text-center font-bold font-mono border-zinc-800 dark:bg-[#1a1b26]">
    <span class="">file</span>
  </div>
  <div class="font-mono leading-tight">
    <pre class=""><code class="language-yaml hljs px-5 border-b-4 border-l-4 border-r-4 border-zinc-800 rounded-b-lg"># /etc/salt/master


# File configs

file_roots:
  base:
    - /srv/salt/
    - /srv/salt/pillar
    - /srv/salt/states
    - /srv/salt/reactors
    - /srv/salt/templates
    - /srv/salt/files

# Pillar configs

pillar_roots:
  base:
    - /srv/salt/pillar</code></pre>
  </div>
</div>
<!-- CODE BLOCK END -->



  <p>Minion</p>

  
<!-- CODE BLOCK START -->
<div id="code-block" class="py-2">
  <div class="border-4 rounded-t-lg border-b-4 py-1 text-center font-bold font-mono border-zinc-800 dark:bg-[#1a1b26]">
    <span class="">file</span>
  </div>
  <div class="font-mono leading-tight">
    <pre class=""><code class="language-yaml hljs px-5 border-b-4 border-l-4 border-r-4 border-zinc-800 rounded-b-lg"># /etc/salt/minion


# Master IP or DNS name

master: master01

# ID of minion

id: minion01</code></pre>
  </div>
</div>
<!-- CODE BLOCK END -->


  <p>
    A complete list of <a class="break-words text-sky-600 no-underline hover:text-sky-900" href="https://docs.saltstack.com/en/latest/ref/configuration/examples.html" target=_blank>configuration</a>

    options can be found in the documentation.
  </p>

  <h4><b>Firewall Ports</b></h4>
  <p>
    The Salt master and minions communicate over an AES encrypted ZeroMQ connection on TCP ports 4505 and 4506.
    These ports only need to be opened on the Salt master. Suggested methods for openning the firewall ports can be
    found in the
    <a class="break-words text-sky-600 no-underline hover:text-sky-900" href="https://docs.saltstack.com/en/latest/topics/tutorials/firewall.html" target=_blank>official documentation</a>
.
  </p>

  <h3 id="salt-keys">Salt Keys</h3>
  <p>
    Salt uses RSA keys to authenticate the master and the minions. By default minions are not automatically
    allowed to communicate with the master. When a minion tries to connect to the master it will send its
    RSA public key, the master must accept the minions key to permit the minion access. There are a number
    of 'states' that minion keys can exist in on the master, they are outlined as follows.
  </p>
  <h4><b>Key States</b></h4>
  <ul>
    <li><b>Unaccepted</b> - Key not yet accepted by the master.</li>
    <li><b>Accepted</b> - Key accepted allowing communication between the master and minion.</li>
    <li><b>Rejected</b> - Key has been rejected manually by the master.</li>
    <li><b>Denied</b> - Key automatically rejected by master, due to duplicate minion id or generated by minion.</li>
  </ul>

  <p>
    The <span class="px-2 py-1 font-mono font-semibold rounded bg-zinc-900 border border-zinc-800 text-emerald-400 dark:text-emerald-700">salt-key</span>
 command is used on the master to manage the keys of the minions. More on the
    <span class="px-2 py-1 font-mono font-semibold rounded bg-zinc-900 border border-zinc-800 text-emerald-400 dark:text-emerald-700">salt-key</span>
 command can be found in the
    <a class="break-words text-sky-600 no-underline hover:text-sky-900" href="https://docs.saltstack.com/en/latest/ref/cli/salt-key.html" target=_blank>docs</a>
.
  </p>

  <h3 id="inventory">Inventory</h3>
  <p>
    The inventory in Salt is defined by the accepted minion keys. Groups of minions can be targeted in the states
    <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">top.sls</span>
 file. There are many option for targeting minions, the below
    uses a wildcard <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">*</span>
.
  </p>


  
<!-- CODE BLOCK START -->
<div id="code-block" class="py-2">
  <div class="border-4 rounded-t-lg border-b-4 py-1 text-center font-bold font-mono border-zinc-800 dark:bg-[#1a1b26]">
    <span class="">file</span>
  </div>
  <div class="font-mono leading-tight">
    <pre class=""><code class="language-yaml hljs px-5 border-b-4 border-l-4 border-r-4 border-zinc-800 rounded-b-lg"># /srv/salt/states/top.sls
base:
  '*':
    - vim # states to be applied
    - motd
  'master*':
    - curl
  'minion*':
    - python
  'proxy-minion*':
    - python
    - napalm</code></pre>
  </div>
</div>
<!-- CODE BLOCK END -->


  <h3 id="modules">Modules</h3>
  <p>
    Modules are the engine room of Salt and how state is applied to minions. Salt has a HUUUUGGGEEEE
    list of <a class="break-words text-sky-600 no-underline hover:text-sky-900" href="https://docs.saltstack.com/en/latest/ref/index.html" target=_blank>modules</a>
 that
    likely do most of what you will ever need.
  </p>
  <h4>Example Salt Modules</h4>
  <ul>
    <li><b>Pillar</b> - Working with pillar data from external sources such has Heira.</li>
    <li><b>Proxy</b> - For use with proxy minions such Napalm to control network devices.</li>
    <li><b>State</b> - Use to apply state to minions such as installing system packages.</li>
  </ul>

  <p>
    Module documentation can also be read from the command line with the <span class="px-2 py-1 font-mono font-semibold rounded bg-zinc-900 border border-zinc-800 text-emerald-400 dark:text-emerald-700">sys.doc</span>
 command.
  </p>

  
<!-- CODE BLOCK START -->
<div id="code-block" class="py-2">
  <div class="border-4 rounded-t-lg border-b-4 py-1 text-center font-bold font-mono border-zinc-800 dark:bg-[#1a1b26]">
    <span class="">cmd</span>
  </div>
  <div class="font-mono leading-tight">
    <pre class=""><code class="language-text hljs px-5 border-b-4 border-l-4 border-r-4 border-zinc-800 rounded-b-lg">sudo salt '*' sys.doc network</code></pre>
  </div>
</div>
<!-- CODE BLOCK END -->


  <p>
    It is also possible to write custom Salt modules. If you need something additional to what Salt provides
    out of the box the process is documented
    <a class="break-words text-sky-600 no-underline hover:text-sky-900" href="https://docs.saltstack.com/en/latest/ref/modules/" target=_blank>here</a>
.
  </p>

  <h3 id="states">States</h3>
  <p>
    States define how a minion should be configured. The state system is made up of multiple layers,
    the layers from highest to lowest are as follows.
  </p>
  <ul>
    <li>Orchestrate</li>
    <li>High State</li>
    <li>SLS</li>
    <li>High Data</li>
    <li>Low State</li>
    <li>Low Chunk</li>
    <li>Function Call</li>
  </ul>

  <p>
    More details on the state layers can be found <a href="https://docs.saltstack.com/en/latest/ref/states/layers.html">
      here</a>
.
  </p>

  <p>
    The main states to be aware of are the <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">high</span>
 and
    <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">low</span>
 states.
  </p>
  <h4><b>High State</b></h4>
  <p>
    The high state defines the complete configuration state that should be applied to a minion.
    The high state is defined in the <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">top.sls</span>

    file and is applied with the <span class="px-2 py-1 font-mono font-semibold rounded bg-zinc-900 border border-zinc-800 text-emerald-400 dark:text-emerald-700">salt '&lt;target&gt;' state.apply</span>
 command.
  </p>

  <h4><b>Low State</b></h4>
  <p>
    The low state is a list of function calls that will be executed.
  </p>

  <h4><b>State Tree</b></h4>
  <p>
    The state tree is a collection of <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">.sls</span>

    files and directories under the <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">states</span>
 directory.
    The <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">states</span>
 directory is specified under the
    <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">file_roots</span>
 configuration parameter in the
    <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">master</span>
 configuration file. This is usually set to
    <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">/srv/salt/states</span>
.
  </p>

  
<!-- CODE BLOCK START -->
<div id="code-block" class="py-2">
  <div class="border-4 rounded-t-lg border-b-4 py-1 text-center font-bold font-mono border-zinc-800 dark:bg-[#1a1b26]">
    <span class="">output</span>
  </div>
  <div class="font-mono leading-tight">
    <pre class=""><code class="language-text hljs px-5 border-b-4 border-l-4 border-r-4 border-zinc-800 rounded-b-lg"># /srv/salt/states

states/
├── development-tools.sls
├── epel-release.sls
├── motd
│   ├── init.sls
│   └── motd.j2
├── napalm
│   ├── init.sls
│   └── map.jinja
├── python
│   ├── init.sls
│   ├── map.jinja
│   ├── pip.sls
│   └── python.sls
├── top.sls
└── vim
    ├── init.sls
    └── map.jinja</code></pre>
  </div>
</div>
<!-- CODE BLOCK END -->


  <h4><b>SLS Files</b></h4>
  <p>
    <b>S</b>a<b>L</b>t <b>S</b>tate roughly translates to <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">.sls</span>
 hence
    the <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">.sls</span>
 extension.
    Salt state files, by default are defined in YAML and describe the 'state'
    to apply to a minion. State files are passed through YAML and Jinja renderers by default, but it
    is possible to use different renderers to build the <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">.sls</span>
 files.
  </p>

  <p>
    The following sets the <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">states</span>
 directory for the
    <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">base</span>
 environment.
  </p>

  
<!-- CODE BLOCK START -->
<div id="code-block" class="py-2">
  <div class="border-4 rounded-t-lg border-b-4 py-1 text-center font-bold font-mono border-zinc-800 dark:bg-[#1a1b26]">
    <span class="">file</span>
  </div>
  <div class="font-mono leading-tight">
    <pre class=""><code class="language-yaml hljs px-5 border-b-4 border-l-4 border-r-4 border-zinc-800 rounded-b-lg"># /etc/salt/master

file_roots:
  base:<span class="hljs-string">
    - /srv/salt/states</span>
</code></pre>
  </div>
</div>
<!-- CODE BLOCK END -->


  <p>
    More on Salt states can be found in the <a
       href="https://docs.saltstack.com/en/latest/ref/states/">documentation.</a>

  </p>

  <h4><b>Map Files</b></h4>
  <p>
    Map files are dictionaries that can be used to define variables across different systems. The below
    map file sets the <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">vim</span>
 package name based on the
    <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">os_family</span>
 grain.
  </p>
  <p>
    Map files are generally name <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">map.jinja</span>

  </p>

  
<!-- CODE BLOCK START -->
<div id="code-block" class="py-2">
  <div class="border-4 rounded-t-lg border-b-4 py-1 text-center font-bold font-mono border-zinc-800 dark:bg-[#1a1b26]">
    <span class="">file</span>
  </div>
  <div class="font-mono leading-tight">
    <pre class=""><code class="language-python hljs px-5 border-b-4 border-l-4 border-r-4 border-zinc-800 rounded-b-lg">{% set vim = salt.grains.filter_by({
    'Debian': {
        'pkg': 'vim',
    },
    'RedHat': {
        'pkg': 'vim-enhanced',
    },
}) %}</code></pre>
  </div>
</div>
<!-- CODE BLOCK END -->


  <h3 id="grains">Grains</h3>
  <p>
    Grains are facts about a device that are collected by Salt. Grains can be used to target minions and as
    variables in configuration templates.
  </p>
  <p>
    Display a list the available grains with the <span class="px-2 py-1 font-mono font-semibold rounded bg-zinc-900 border border-zinc-800 text-emerald-400 dark:text-emerald-700">grains.ls</span>
 command.
  </p>


  
<!-- CODE BLOCK START -->
<div id="code-block" class="py-2">
  <div class="border-4 rounded-t-lg border-b-4 py-1 text-center font-bold font-mono border-zinc-800 dark:bg-[#1a1b26]">
    <span class="">cmd</span>
  </div>
  <div class="font-mono leading-tight">
    <pre class=""><code class="language-text hljs px-5 border-b-4 border-l-4 border-r-4 border-zinc-800 rounded-b-lg">sudo salt '&lt;target&gt;' grains.ls</code></pre>
  </div>
</div>
<!-- CODE BLOCK END -->


  <p>
    Grain data can be displayed with the <span class="px-2 py-1 font-mono font-semibold rounded bg-zinc-900 border border-zinc-800 text-emerald-400 dark:text-emerald-700">grains.items</span>
 command.
  </p>

  
<!-- CODE BLOCK START -->
<div id="code-block" class="py-2">
  <div class="border-4 rounded-t-lg border-b-4 py-1 text-center font-bold font-mono border-zinc-800 dark:bg-[#1a1b26]">
    <span class="">cmd</span>
  </div>
  <div class="font-mono leading-tight">
    <pre class=""><code class="language-text hljs px-5 border-b-4 border-l-4 border-r-4 border-zinc-800 rounded-b-lg">sudo salt '&lt;target&gt;' grains.items</code></pre>
  </div>
</div>
<!-- CODE BLOCK END -->



  <p>
    Custom grains can be set on the minions in the following locations
  </p>
  <ul>
    <li><span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">/etc/salt/minion</span>
 - Config file under the grains section</li>
    <li><span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">/etc/salt/grains</span>
 - Grains file on the minion</li>
  </ul>
  <p>
    The documentation on grains can be found
    <a class="break-words text-sky-600 no-underline hover:text-sky-900" href="https://docs.saltstack.com/en/latest/topics/grains/index.html" target=_blank>here</a>
.
  </p>

  <h3 id="pillar">Pillar</h3>
  <p>
    Pillar is minion specific data that can be anything and is defined by the administrator.
    Like states, pillar uses a <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">top.sls</span>
 file to match minions to pillar
    data. Also like states, pillar data is stored in <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">.sls</span>
 files
    using YAML syntax.
  </p>
  <p>
    The source pillar folder is defined in the <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">/etc/salt/master</span>
 config under the
    <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">pillar_roots</span>
 section.
  </p>

  
<!-- CODE BLOCK START -->
<div id="code-block" class="py-2">
  <div class="border-4 rounded-t-lg border-b-4 py-1 text-center font-bold font-mono border-zinc-800 dark:bg-[#1a1b26]">
    <span class="">file</span>
  </div>
  <div class="font-mono leading-tight">
    <pre class=""><code class="language-yaml hljs px-5 border-b-4 border-l-4 border-r-4 border-zinc-800 rounded-b-lg"># /etc/salt/master

pillar_roots:
  base:
    - /srv/salt/pillar</code></pre>
  </div>
</div>
<!-- CODE BLOCK END -->


  <p>
    Pillar data can be accessed in states by calling the <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">pillar</span>
 dictionary
    with the <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">variable</span>
 name.
  </p>

  
<!-- CODE BLOCK START -->
<div id="code-block" class="py-2">
  <div class="border-4 rounded-t-lg border-b-4 py-1 text-center font-bold font-mono border-zinc-800 dark:bg-[#1a1b26]">
    <span class="">file</span>
  </div>
  <div class="font-mono leading-tight">
    <pre class=""><code class="language-yaml hljs px-5 border-b-4 border-l-4 border-r-4 border-zinc-800 rounded-b-lg">vim installed:
  pkg.installed:
    - name: {{ pillar['data_centre'] }}</code></pre>
  </div>
</div>
<!-- CODE BLOCK END -->


  <p>
    See the <a class="break-words text-sky-600 no-underline hover:text-sky-900" href="https://docs.saltstack.com/en/latest/topics/pillar/" target=_blank>docs</a>
 for more on Salt pillar.
  </p>

  <h3 id="templates">Templates</h3>
  <p>
    Templates allow for the reuse of configuration in a DRY fashion. Salt has the ability to use many different
    templating languages including <a class="break-words text-sky-600 no-underline hover:text-sky-900" href="https://jinja.readthedocs.io/en/stable/" target=_blank>Jinja2</a>
 and
    <a class="break-words text-sky-600 no-underline hover:text-sky-900" href="http://www.makotemplates.org/" target=_blank>Mako</a>
.
  </p>
  <p>
    The default templating engine in Salt is Jinja2. With Salt, templating is not isolated to configuration files,
    infact the <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">.sls</span>
 files are a combination of YAML and Jinja2. Below is an
    example of using Jinja2 in an <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">.sls</span>
 file.
  </p>


  
<!-- CODE BLOCK START -->
<div id="code-block" class="py-2">
  <div class="border-4 rounded-t-lg border-b-4 py-1 text-center font-bold font-mono border-zinc-800 dark:bg-[#1a1b26]">
    <span class="">file</span>
  </div>
  <div class="font-mono leading-tight">
    <pre class=""><code class="language-yaml hljs px-5 border-b-4 border-l-4 border-r-4 border-zinc-800 rounded-b-lg"># states/python/python.sls
{% from 'python/map.jinja' import required_packages with context %}
{% from 'python/map.jinja' import python_versions with context %}

python-install-required-packages:
  pkg:
    - installed
    - pkgs:
        {{ required_packages.pkgs }}

{% for python in python_versions %}
Python-{{ python.release }}.tgz:
  file.managed:
    - name: /tmp/Python-{{ python.release }}.tgz
    - source: salt://files/Python-{{ python.release }}.tgz
    - source_hash: {{ python.hash }}

extract-python-{{ python.release }}:
  archive.extracted:
    - name: /tmp
    - source: /tmp/Python-{{ python.release }}.tgz

python-build-{{ python.release }}:
  cmd.run:
    - cwd: /tmp/Python-{{ python.release }}
    - user: root
    - name: |
        ./configure --prefix=/usr/local
        make
        make altinstall
    - unless: stat /usr/local/bin/python{{ python.version }}

/usr/bin/python{{ python.release }}:
  file.symlink:
    - target: /usr/local/bin/python{{ python.version }}
{% endfor %}</code></pre>
  </div>
</div>
<!-- CODE BLOCK END -->


  
<!-- NOTE BLOCK START -->
<div id="note-block" class="pt-2 pb-4">
  <div class="shadow-md shadow-zinc-400 bg-sky-100 rounded border-l-8 border-l-sky-900 dark:border-l-sky-600 dark:bg-sky-800 dark:shadow-none">
    <div class="px-4 pt-4 pb-2 text-sky-900 dark:text-zinc-900"><i class="far fa-check-circle" aria-hidden="true"></i><b class="pl-1.5">Note</b></div>
    <div class="px-4 pb-4 dark:text-zinc-900">
    Jinja is not a programming language, so use is sparingly and keeps it simple.
</div>
  </div>
</div>
<!-- NOTE BLOCK END -->


  <h3 id="formula">Formula</h3>
  <p>
    Salt formulas are pre-written Salt states that do a thing. For example
    there is a Salt formula to install <a href="https://github.com/saltstack-formulas/napalm-install-formula">
      Napalm</a>
 the network automation library. Salt has a github
    organization for formulas which can be found <a class="break-words text-sky-600 no-underline hover:text-sky-900" href="https://github.com/saltstack-formulas" target=_blank>here</a>
.
  </p>



            
  


            
  


            
  
    
  <!-- LINKS START -->
  <div class="pb-2">
    <h3 id="links">Links</h3>
      
        <p class="text-xl break-words">
          <a class="break-words text-sky-600 no-underline hover:text-sky-900" href="https://saltstack.com/" target=_blank>https://saltstack.com/</a>
        </p>
      
        <p class="text-xl break-words">
          <a class="break-words text-sky-600 no-underline hover:text-sky-900" href="https://saltstack.com/salt-open-source/" target=_blank>https://saltstack.com/salt-open-source/</a>
        </p>
      
        <p class="text-xl break-words">
          <a class="break-words text-sky-600 no-underline hover:text-sky-900" href="https://github.com/saltstack/salt" target=_blank>https://github.com/saltstack/salt</a>
        </p>
      
        <p class="text-xl break-words">
          <a class="break-words text-sky-600 no-underline hover:text-sky-900" href="https://docs.saltstack.com/en/develop/topics/network_automation/index.html" target=_blank>https://docs.saltstack.com/en/develop/topics/network_automation/index.html</a>
        </p>
      
  </div>
  <!-- LINKS END -->

  


            
  
    
<!-- TAGS START -->
  <div id="tags" class="pb-2">
    <div class="flex flex-wrap justify-center">
      
        <div class=" text-rose-700 hover:text-rose-900 font-semibold italic lowercase tracking-wide">
          <i class="-mr-1.5 text-2xl">#</i>
          <a href="/blog/tag/#salt" class="text-xl">salt</a>        
        </div>
      
    </div>
  </div>
<!-- TAGS END -->

  


            
  
<!-- BLANK PAGE START -->
<div id="blank-page">
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
</div>
<!-- BLANK PAGE END -->


          </div>
        </div>
        <!-- COLUMN 2 END -->

        <!-- COLUMN 3 START -->
        <div class="invisible md:visible md:col-span-3 max-h-screen sticky top-20">
          
  
    
<!-- TABLE OF CONTENTS START -->
<div id="table-of-contents" class="invisible md:visible h-4/5 overflow-y-auto">
  <div class="">
    <h5 class="">On this page</h5>
  </div>
  <div class="">
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#overview">
            Overview
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#architecture">
            Architecture
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#topologies">
            Topologies
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#install">
            Install
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#configuration">
            Configuration
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#salt-keys">
            Salt Keys
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#inventory">
            Inventory
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#modules">
            Modules
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#states">
            States
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#grains">
            Grains
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#pillar">
            Pillar
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#templates">
            Templates
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#formula">
            Formula
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#links">
            Links
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#tags">
            Tags
          </a>
        </div>
      
      
  </div>
</div>
<!-- TABLE OF CONTENTS END -->

  

        </div>
        <!-- COLUMN 3 END -->

      </div>
      <!-- CONTENT END -->

      <!-- BACK TO TOP START -->
<div id="back-to-top" class="hidden fixed bottom-20 right-16 rounded-full font-semibold text-zinc-900 bg-neutral-400 hover:bg-neutral-100">
  <button type="button" class="">
    <i class="fas fa-arrow-circle-up fa-3x"></i>
  </button>
</div>
<!-- BACK TO TOP END -->
    </div>
  
    <!-- FOOTER START -->
<div id="footer" class="fixed inset-x-0 bottom-0">
  <div class="flex justify-center w-full py-4 bg-zinc-900 shadow-lg">
    <div class="text-center">
      <a class="px-2 font-semibold text-neutral-400 hover:text-neutral-100" href="https://twitter.com/codingpackets" target="_blank"><i class="fab fa-twitter fa-2x"></i></a>
      <a class="px-2 font-semibold text-neutral-400 hover:text-neutral-100" href="https://www.twitch.tv/codingpackets" target="_blank"><i class="fab fa-twitch fa-2x"></i></a>
      <a class="px-2 font-semibold text-neutral-400 hover:text-neutral-100" href="https://github.com/bwks" target="_blank"><i class="fab fa-github fa-2x"></i></a>
      <a class="px-2 font-semibold text-neutral-400 hover:text-neutral-100" href="/blog/feed.xml" target="_blank"><i class="fa fa-rss fa-2x"></i></a>
    </div>
  </div>
</div>
<!-- FOOTER END -->

  </body>

</html>
