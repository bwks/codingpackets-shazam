



<!DOCTYPE html>
<html lang="en" class="dark scroll-smooth scroll-pt-[4.5rem]">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    
      <link rel="shortcut icon" href="/favicon/favicon.ico" type="image/x-icon">
    
    
    
      <link rel="stylesheet" href="/css/highlightjs/tokyo-night-dark.min.css">
      <link rel="stylesheet" href="/css/fontawesome/css/all.min.css">
    

    
      <link rel="stylesheet" href="/css/app.css">
    

    
      <script src="/js/highlightjs/highlightjs-11.7.0.min.js"></script>
      <script src="/js/highlightjs/terraform.js"></script>
      <script defer src="/js/fontawesome/js/all.js"></script>
    

    
      <script defer src="/js/custom/back-to-top.js"></script>
      <script defer src="/js/custom/light-switch.js"></script>
    

    
      <script>
        hljs.registerLanguage('terraform', window.hljsDefineTerraform);
        hljs.highlightAll();
      </script>
    

    
    

    <title>codingpackets.com</title>
  </head>

  <body class="bg-stone-50 dark:bg-black tracking-wide">

    <!-- NAVBAR START -->
<nav id="navbar" class="w-full py-3 bg-zinc-900 text-xl shadow-lg fixed inset-x-0 top-0 z-50">
  <div class="flex justify-center items-center py-1">
    <div>
      <a class="text-neutral-400 hover:text-neutral-100 p-0" href="/">Me</a>
    </div>
    <div class="px-4">
      <p class="text-neutral-400 p-0">|</p>
    </div>
    <div>
      <a class="text-neutral-400 hover:text-neutral-100" href="/blog/">Blog</a>
    </div>
    <div class="px-4">
      <p class="text-neutral-400 p-0">|</p>
    </div>
    <div>
      <a class="text-neutral-400 hover:text-neutral-100" href="/blog/recent/">Recent</a>
    </div>
    <div class="px-4">
      <p class="text-neutral-400 p-0">|</p>
    </div>
    <div class="-mt-6 -ml-1">
      <labeL class="relative inline-block">
        <input type="checkbox" id="light-switch" class="opacity-0 w-0 h-0">
        <img id="light-bulb" class="opacity-90 hover:opacity-60 dark:opacity-60 dark:hover:opacity-100 p-0 w-7" src="/img/light-bulb-64-light.png" alt="on/off">
      </labeL>
    </div>
  </div>  
</nav>
<!-- NAVBAR END -->

    <div class="w-full">
      
  
    
<!-- PAGE HEADER START -->
<div class="grid grid-cols-12 gap-8">
  <div class="invisible md:visible md:col-span-3">
  </div>

  <div class="col-span-12 px-5 md:col-span-6">
    <div id="page-header" class="pt-20 -mb-4 pb-0 px-5 text-center sm:pb-4 sm:mb-0">
      <h1 class="pb-1 sm:pb-2">Network Notes: STP</h1>
      <div class="">
        
        
          <p class="text-neutral-500 dark:text-neutral-600 text-lg italic p-0">
            published: 1st of August 2018
          </p>
        
      </div>
    </div>
  </div>

  <div class="invisible md:visible md:col-span-3">
  </div>
</div>
<!-- PAGE HEADER END -->

  


      <!-- CONTENT START -->
      <div class="grid grid-cols-12 gap-8">

        <!-- COLUMN 1 START -->
        <div class="invisible md:visible md:col-span-3">
        </div>
        <!-- COLUMN 1 END -->

        <!-- COLUMN 2 START -->
        <div class="col-span-12 px-5 md:col-span-6">
          <div class="text-xl text-gray-800 dark:text-neutral-400 font-medium leading-relaxed md:leading-relaxed">
            

  <h3 id="overview">Overview</h3>

  <p>
    Spanning tree protocols are used to prevent layer 2 loops in a switched network. There
    are various forms of spanning tree that have been standardized by the IEEE.
    The original standards; 802.1D - Legacy Spanning Tree (STP), 802.1w - Rapid Spanning Tree
    (RSTP) and 802.1s - Multiple Spanning Tree (MSTP) have now evolved. The 802.1D standard
    covers RSTP but does not include legacy STP as it is considered obsolete.
    MSTP is incorporated into the 802.1Q standard. Additionally Cisco has its own proprietary
    implementation of legacy STP (PVST+) and RSTP (Rapid PVST+) which add
    support for a spanning tree instance per VLAN.
  </p>

  <h3 id="stp">Legacy Spanning Tree Protocol (STP)</h3>

  <p>
    Standardized in 1993 by the IEEE as <a class="text-sky-600 no-underline hover:text-sky-900" href="http://ieee802.org/1/pages/802.1D.html" target=_blank>802.1D</a>.
    STP is used to create a loop free flooding domain by calculating the shortest path from
    each bridge to a single root bridge.
  </p>

  
<!-- NOTE BLOCK START -->
<div id="note-block" class="pt-2 pb-4">
  <div class="shadow-md shadow-zinc-400 bg-sky-100 rounded border-l-8 border-l-sky-900 dark:border-l-sky-600 dark:bg-sky-800 dark:shadow-none">
    <div class="px-4 pt-4 pb-2 text-sky-900 dark:text-zinc-900"><i class="far fa-check-circle" aria-hidden="true"></i><b class="pl-1.5">Note</b></div>
    <div class="px-4 pb-4 dark:text-zinc-900">
    <p>
      A switch in spanning tree is referred to as a bridge.
    </p>
</div>
  </div>
</div>
<!-- NOTE BLOCK END -->


  <h4><b>Bridge Protocol Data Unit (BPDU)</b></h4>
  <p>
    STP messages are passed around a switching domain in the form of a BPDU. Legacy STP uses two
    types of BPDUs; Configuration BPDUs and Topology Change Notification BPDUs. Configuration
    BPDUs are used to build a topology, TCN BPDUs advertise changes in the topology.
  </p>

  
<!-- IMAGE START -->
<div class="pt-4 pb-6 flex justify-center">
  <img class="bg-white rounded-lg shadow-md shadow-zinc-400 dark:opacity-80 dark:shadow-none" 
    width="500px" 
    src="/img/blog/stp/stp-bpdus.svg" alt="blog/stp/stp-bpdus.svg">
</div>
<!-- IMAGE END -->

  <p>
    Switch ports that participate in spanning tree transmit and receive BPDUs on each LAN segment.
    Switches compare received BPDUs to their own BPDUs to determine which BPDU is
    <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">superior</span>
. The superior BPDU is then stored for
    future comparison with received BPDUs and also advertised out any designated ports.
  </p>
  <p>
    The superior BPDU is determined by examining the following parameters (from top to bottom)
    the lowest value wins. When a superior value is found, the comparison stops. If the values
    are equal, the next parameter is examined.
  </p>

  <ul>
    <li>Root Bridge ID</li>
    <li>Root Path Cost</li>
    <li>Sender Bridge ID</li>
    <li>Sender Port ID</li>
    <li>Receiver Port ID (local evaluation only)</li>
  </ul>

  
<!-- NOTE BLOCK START -->
<div id="note-block" class="pt-2 pb-4">
  <div class="shadow-md shadow-zinc-400 bg-sky-100 rounded border-l-8 border-l-sky-900 dark:border-l-sky-600 dark:bg-sky-800 dark:shadow-none">
    <div class="px-4 pt-4 pb-2 text-sky-900 dark:text-zinc-900"><i class="far fa-check-circle" aria-hidden="true"></i><b class="pl-1.5">Note</b></div>
    <div class="px-4 pb-4 dark:text-zinc-900">
    <p>
      In a stabilized STP domain the root bridges BPDU is forwarded by all other switches as
      it will always be the superior BPDU.
    </p>
</div>
  </div>
</div>
<!-- NOTE BLOCK END -->


  <h4><b>Topology Changes</b></h4>
  <p>
    The responsibility of advertising topology changes falls on the root bridge. TCN BPDUs are
    forwarded up the tree to the root bridge. The root then advertises the changes back into the
    spanning tree domain.
  </p>

  <h4><b>Root Bridge</b></h4>
  <p>
    In legacy STP, there can be exactly one root bridge. Configuration BPDUs are used to build
    a loop free topology toward the root bridge.
  </p>

  <p>
    The root bridge is determined via an election. The switch with the
    <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">lowest bridge ID</span>
 will become the root bridge. The
    bridge ID is composed of a 2 Byte priority field (default 32768 + vlan-id) and a MAC address.
  </p>

  <h4><b>Legacy STP Bridge ID</b></h4>
  
<!-- IMAGE START -->
<div class="pt-4 pb-6 flex justify-center">
  <img class="bg-white rounded-lg shadow-md shadow-zinc-400 dark:opacity-80 dark:shadow-none" 
    width="650px" 
    src="/img/blog/stp/stp-bridge-id.svg" alt="blog/stp/stp-bridge-id.svg">
</div>
<!-- IMAGE END -->


  <p>
    Once the Root bridge has been elected each non-root bridge will determine its root, designated
    and blocking ports.
  </p>

  <h4><b>Port Roles and States</b></h4>
  <p>
    Ports connected to other switches in spanning tree end up as one of the following port roles
    and forwarding states.
  </p>


<!-- TABLE DEFAULT START -->
<div id="table-default" class="py-2 text-xl font-mono tracking-normal">
  <div class="rounded-md shadow-md shadow-zinc-400 dark:shadow-zinc-900 overflow-auto">
    <table class="table-auto w-full">
      <thead class="text-center">
        <tr class="bg-zinc-900 text-neutral-400 dark:text-neutral-400">
        
          
            <th class="py-1 px-2 border-b border-r border-zinc-800">Port Type</th>
          
        
          
            <th class="py-1 px-2 border-b border-zinc-800">Description</th>
          
        
        </tr>
      </thead>
      <tbody>
      
        
        
          <tr class="border-b border-zinc-800">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">Root Port </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> Forwarding towards the root</td>
            
          
        </tr>
      
        
        
          <tr class="border-b border-zinc-800">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">Designated Port </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> Forwarding away from the root</td>
            
          
        </tr>
      
        
        
          <tr class="">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">Alternate Port </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> Blocking to prevent spanning tree loops</td>
            
          
        </tr>
      
      </tbody>
    </table>
  </div>
</div>
<!-- TABLE DEFAULT END -->


  
<!-- IMAGE START -->
<div class="pt-4 pb-6 flex justify-center">
  <img class="bg-white rounded-lg shadow-md shadow-zinc-400 dark:opacity-80 dark:shadow-none" 
    width="650px" 
    src="/img/blog/stp/stp-port-types-states.svg" alt="blog/stp/stp-port-types-states.svg">
</div>
<!-- IMAGE END -->


  <p>
    Each non-root bridge can have only one root port, one designated port per segment
    and zero or more blocking ports.
  </p>

  <h4><b>Port Roles Selection Process</b></h4>
  <p>
    For each LAN segment the switch with the superior BPDU is known as the designated switch.
    The port with the superior BPDU is the designate port. The designated port originates or
    forwards BPDUs.
  </p>
  <ul>
    <li>
      The root bridge sends BPDUs out of its designated ports. All ports on the root bridge
      are designated.
    </li>
    <li>
      On each non root bridge, the root port is the port that receives the superior BPDU.
    </li>
    <li>
      Non root bridges add the port cost to the superior BPDU and forward it out all its
      designated ports.
    </li>
    <li>
      All other ports connecting to the segment which do not send or receive a superior
      BPDU are placed in a blocking state.
    </li>
  </ul>

  
<!-- NOTE BLOCK START -->
<div id="note-block" class="pt-2 pb-4">
  <div class="shadow-md shadow-zinc-400 bg-sky-100 rounded border-l-8 border-l-sky-900 dark:border-l-sky-600 dark:bg-sky-800 dark:shadow-none">
    <div class="px-4 pt-4 pb-2 text-sky-900 dark:text-zinc-900"><i class="far fa-check-circle" aria-hidden="true"></i><b class="pl-1.5">Note</b></div>
    <div class="px-4 pb-4 dark:text-zinc-900">
    <p>
      BPDUs are sent every 2 seconds by default and act as a hello/keepalive.
    </p>
</div>
  </div>
</div>
<!-- NOTE BLOCK END -->


  <h4><b>Port States</b></h4>
  <p>
    Non-disabled ports in legacy STP transition through a number of states staring with
    blocking and eventually end up in either a forwarding state or back to a blocking state.
  </p>

  
<!-- TABLE DEFAULT START -->
<div id="table-default" class="py-2 text-xl font-mono tracking-normal">
  <div class="rounded-md shadow-md shadow-zinc-400 dark:shadow-zinc-900 overflow-auto">
    <table class="table-auto w-full">
      <thead class="text-center">
        <tr class="bg-zinc-900 text-neutral-400 dark:text-neutral-400">
        
          
            <th class="py-1 px-2 border-b border-r border-zinc-800">State</th>
          
        
          
            <th class="py-1 px-2 border-b border-r border-zinc-800">Timer</th>
          
        
          
            <th class="py-1 px-2 border-b border-zinc-800">Learns MACs</th>
          
        
        </tr>
      </thead>
      <tbody>
      
        
        
          <tr class="border-b border-zinc-800">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">Disabled </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-r border-zinc-800"> N/A </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> No</td>
            
          
        </tr>
      
        
        
          <tr class="border-b border-zinc-800">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">Blocking </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-r border-zinc-800"> 20 </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> No</td>
            
          
        </tr>
      
        
        
          <tr class="border-b border-zinc-800">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">Listening </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-r border-zinc-800"> 15 </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> No</td>
            
          
        </tr>
      
        
        
          <tr class="border-b border-zinc-800">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">Learning </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-r border-zinc-800"> 15 </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> Yes</td>
            
          
        </tr>
      
        
        
          <tr class="">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">Forwarding </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-r border-zinc-800"> N/A </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> Yes</td>
            
          
        </tr>
      
      </tbody>
    </table>
  </div>
</div>
<!-- TABLE DEFAULT END -->



  <h4><b>Port Costs</b></h4>
  <p>
    Prior to the 802.1D-1998 standard the IEEE did not define spanning tree costs per port
    type. Cisco did make up their own port costs which are not shown in the table below.
  </p>

    
<!-- TABLE DEFAULT START -->
<div id="table-default" class="py-2 text-xl font-mono tracking-normal">
  <div class="rounded-md shadow-md shadow-zinc-400 dark:shadow-zinc-900 overflow-auto">
    <table class="table-auto w-full">
      <thead class="text-center">
        <tr class="bg-zinc-900 text-neutral-400 dark:text-neutral-400">
        
          
            <th class="py-1 px-2 border-b border-r border-zinc-800">Port Speed</th>
          
        
          
            <th class="py-1 px-2 border-b border-r border-zinc-800">802.1D-1998 Cost</th>
          
        
          
            <th class="py-1 px-2 border-b border-zinc-800">802.1D-2004 Cost</th>
          
        
        </tr>
      </thead>
      <tbody>
      
        
        
          <tr class="border-b border-zinc-800">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">10 Mbps </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-r border-zinc-800"> 100 </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> 2000000</td>
            
          
        </tr>
      
        
        
          <tr class="border-b border-zinc-800">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">100 Mbps </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-r border-zinc-800"> 19 </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> 200000</td>
            
          
        </tr>
      
        
        
          <tr class="border-b border-zinc-800">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">1 Gbps </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-r border-zinc-800"> 4 </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> 20000</td>
            
          
        </tr>
      
        
        
          <tr class="">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">10 Gbps </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-r border-zinc-800"> 2 </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> 2000</td>
            
          
        </tr>
      
      </tbody>
    </table>
  </div>
</div>
<!-- TABLE DEFAULT END -->


  <h3 id="rstp">Rapid Spanning Tree Protocol (RSTP)</h3>

  <p>
    RSTP was originally standardized by the IEEE in
    <a class="text-sky-600 no-underline hover:text-sky-900" href="http://www.ieee802.org/1/pages/802.1w.html" target=_blank>802.1w</a>. In 2004 RSTP was incorporated
    into the <a class="text-sky-600 no-underline hover:text-sky-900" href="http://www.ieee802.org/1/pages/802.1D-2003.html" target=_blank>802.1D</a> standard.
    RSTP contains a number of enhancements over its predecessor with the main goal of improving
    the speed of convergence. Correctly design RSTP domains can achieve sub second link failover
    and convergence.
  </p>

  <h4><b>Port Roles</b></h4>
  <p>
    The was some adjustments to the ports states in RSTP outlined as follows.
  </p>

      
<!-- TABLE DEFAULT START -->
<div id="table-default" class="py-2 text-xl font-mono tracking-normal">
  <div class="rounded-md shadow-md shadow-zinc-400 dark:shadow-zinc-900 overflow-auto">
    <table class="table-auto w-full">
      <thead class="text-center">
        <tr class="bg-zinc-900 text-neutral-400 dark:text-neutral-400">
        
          
            <th class="py-1 px-2 border-b border-r border-zinc-800">Port Type</th>
          
        
          
            <th class="py-1 px-2 border-b border-zinc-800">Description</th>
          
        
        </tr>
      </thead>
      <tbody>
      
        
        
          <tr class="border-b border-zinc-800">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">Root Port </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> Forwarding towards the root, same roles as legacy STP.</td>
            
          
        </tr>
      
        
        
          <tr class="border-b border-zinc-800">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">Designated Port </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> Forwarding away from the root, same roles as legacy STP.</td>
            
          
        </tr>
      
        
        
          <tr class="border-b border-zinc-800">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">Alternate Port </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> Potential replacement for a bridges root port. If the root port is lost the alternate port will rapidly transition (sub-second) to the forwarding state.</td>
            
          
        </tr>
      
        
        
          <tr class="">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">Backup Port </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> Potential replacement for a bridges designated port. Usually only found with a connection to a hub or on a shared segment (non-p2p). If a designated port is lost the transition to a forwarding state does not occur rapidly but is based on timers.</td>
            
          
        </tr>
      
      </tbody>
    </table>
  </div>
</div>
<!-- TABLE DEFAULT END -->


  
<!-- NOTE BLOCK START -->
<div id="note-block" class="pt-2 pb-4">
  <div class="shadow-md shadow-zinc-400 bg-sky-100 rounded border-l-8 border-l-sky-900 dark:border-l-sky-600 dark:bg-sky-800 dark:shadow-none">
    <div class="px-4 pt-4 pb-2 text-sky-900 dark:text-zinc-900"><i class="far fa-check-circle" aria-hidden="true"></i><b class="pl-1.5">Note</b></div>
    <div class="px-4 pb-4 dark:text-zinc-900">
    The default role when a RSTP port becomes active is <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">Designated</span>.
</div>
  </div>
</div>
<!-- NOTE BLOCK END -->


  <h4><b>Port States</b></h4>
  <p>
    The port states in RSTP where simplified into three states.
  </p>

  
<!-- TABLE DEFAULT START -->
<div id="table-default" class="py-2 text-xl font-mono tracking-normal">
  <div class="rounded-md shadow-md shadow-zinc-400 dark:shadow-zinc-900 overflow-auto">
    <table class="table-auto w-full">
      <thead class="text-center">
        <tr class="bg-zinc-900 text-neutral-400 dark:text-neutral-400">
        
          
            <th class="py-1 px-2 border-b border-r border-zinc-800">State</th>
          
        
          
            <th class="py-1 px-2 border-b border-zinc-800">Learns MACs</th>
          
        
        </tr>
      </thead>
      <tbody>
      
        
        
          <tr class="border-b border-zinc-800">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">Discarding </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> No</td>
            
          
        </tr>
      
        
        
          <tr class="border-b border-zinc-800">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">Learning </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> Yes</td>
            
          
        </tr>
      
        
        
          <tr class="">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">Forwarding </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> Yes</td>
            
          
        </tr>
      
      </tbody>
    </table>
  </div>
</div>
<!-- TABLE DEFAULT END -->


  <p>
    The disabled, blocking and listening states from legacy STP where merged into a discarding
    state. Additionally RSTP does not use timers to transition ports from discarding to forwarding,
    it uses a system of proposals and acknowledgements.
  </p>

  <h4><b>Port Types</b></h4>
  <p>
    There are two port types in RSTP; Non-Edge and Edge.
  </p>
    
<!-- TABLE DEFAULT START -->
<div id="table-default" class="py-2 text-xl font-mono tracking-normal">
  <div class="rounded-md shadow-md shadow-zinc-400 dark:shadow-zinc-900 overflow-auto">
    <table class="table-auto w-full">
      <thead class="text-center">
        <tr class="bg-zinc-900 text-neutral-400 dark:text-neutral-400">
        
          
            <th class="py-1 px-2 border-b border-r border-zinc-800">Type</th>
          
        
          
            <th class="py-1 px-2 border-b border-zinc-800">Characteristics</th>
          
        
        </tr>
      </thead>
      <tbody>
      
        
        
          <tr class="border-b border-zinc-800">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">Non-Edge </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> Default port type. Connects to other switches.</td>
            
          
        </tr>
      
        
        
          <tr class="">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">Edge </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> Connects to end hosts. Sends BPDUs, but does expect to received them. Reverts to a Non-Edge type if BPDUs are received.</td>
            
          
        </tr>
      
      </tbody>
    </table>
  </div>
</div>
<!-- TABLE DEFAULT END -->


  <h4><b>Link Types</b></h4>
  <p>
    RSTP defines two classes of links.
  </p>
      
<!-- TABLE DEFAULT START -->
<div id="table-default" class="py-2 text-xl font-mono tracking-normal">
  <div class="rounded-md shadow-md shadow-zinc-400 dark:shadow-zinc-900 overflow-auto">
    <table class="table-auto w-full">
      <thead class="text-center">
        <tr class="bg-zinc-900 text-neutral-400 dark:text-neutral-400">
        
          
            <th class="py-1 px-2 border-b border-r border-zinc-800">Type</th>
          
        
          
            <th class="py-1 px-2 border-b border-zinc-800">Characteristics</th>
          
        
        </tr>
      </thead>
      <tbody>
      
        
        
          <tr class="border-b border-zinc-800">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">Point-to-Point </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> Link connected to exactly one RSTP other switch. Default link type for interfaces negotiated to full-duplex.</td>
            
          
        </tr>
      
        
        
          <tr class="">
        
          
            
              <td class="px-2 pt-1 pb-2 border-r border-zinc-800">Shared </td>
            
          
            
              <td class="px-2 pt-1 pb-2 border-l border-zinc-800"> Link connected to two or more RSTP switches likely via a hub. Default link type for interfaces negotiated to half-duplex.</td>
            
          
        </tr>
      
      </tbody>
    </table>
  </div>
</div>
<!-- TABLE DEFAULT END -->


  <h4><b>RSTP BPDUs</b></h4>
  <p>
    Two field where change in the RSTP BPDU. The version field was updated to version 2 and
    6 unused bits of the flags field are now used to signal; Proposal, Agreement, Port role
    and Port state.
  </p>

  <p>
    Each switch originates its own BPDUs based on the BPDU stored in the root port. Unlike
    legacy STP If a switch receives an inferior BPDU from a segments designated switch, it
    will accept the BPDU immediately as if the superior BPDU had expired. This facilitates
    rapid convergence if a neighboring switch has a connectivity issue towards the root switch.
  </p>

  <h4><b>Proposal and Agreement</b></h4>
  <p>
    RSTP uses the proposal and agreement process to rapidly transition a point-to-point link
    into operation without causing a temporary switching loop.
  </p>
  <p>
    The proposal signals a ports willingness to transition to the designated forwarding state.
    The agreement signals permission to transition. (that's poetry)
  </p>

  <h4><b>Topology Changes</b></h4>
  <p>
    There are no TCN BPDUs in RSTP. RSTP topology changes are advertised by setting the
    Topology Change (TC) bit in the flag field of the BPDU. When a topology change occurs the
    following takes place.
  </p>

  <ul>
    <li>
      BPDUs with the TC bit set are immediately flooded out all non-edge root and designated
      ports except the port the topology change was received from.
    </li>
    <li>
      All MAC addresses learned on the root and designated ports are flushed.
    </li>
    <li>
      BPDUs are sent every <i>Hello</i> interval until the <i>tcWhile (Hello + 1 second)</i>
      timer expires.
    </li>
  </ul>

  <h3 id="mstp">Multiple Spanning Trees (MSTP)</h3>

  <p>
    MSTP was originally standardized by the IEEE in <a class="text-sky-600 no-underline hover:text-sky-900" href="http://www.ieee802.org/1/pages/802.1s.html" target=_blank>802.1s</a>
    in 2005 MSTP became part of the <a class="text-sky-600 no-underline hover:text-sky-900" href="http://www.ieee802.org/1/pages/802.1Q.html" target=_blank>802.1Q</a>
    standard.
  </p>
  <p>
    MSTP is similar to Cisco's proprietary PVST+ implementation except that it does not create
    a spanning tree instance per VLAN. MSTP groups multiple VLANs into a
    instance with generally only a hand full of instances required per switching domain.
  </p>
  <p>
    MSTP groups switches into one or more <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">regions</span>
. Switches
    in an MST region have the same number of MST instances which contain the same VLANs. An
    MST region looks like a single switch to other switches outside the region.
  </p>

  <p>
    MSTP uses a single BPDU to carry information about all MST instances. The MST standard
    permits up to 65 (0 + 64 user defined) active instances. Designated ports for at least
    one instance send BPDUs.
  </p>

  <p>
    MST instance 0 is the default MST instance known as the internal spanning tree (IST).
    By default all VLANs map to instance 0. Instance 0 is used to communicate with switches
    outside the MST region.
  </p>

  
<!-- IMAGE START -->
<div class="pt-4 pb-6 flex justify-center">
  <img class="bg-white rounded-lg shadow-md shadow-zinc-400 dark:opacity-80 dark:shadow-none" 
    width="650px" 
    src="/img/blog/stp/mstp.svg" alt="blog/stp/mstp.svg">
</div>
<!-- IMAGE END -->


  <h3 id="packet-captures">Packet Captures</h3>
  <p>
    Various spanning tree PCAPs can be found
    <a class="text-sky-600 no-underline hover:text-sky-900" href="https://www.dropbox.com/sh/ltg5jhol3dehea0/AADE98wX5nKlum81T_7nL8Zna?dl=0" target=_blank>here</a>.
  </p>




            
  


            
  
    
<!-- TABLE BIBLIOGRAPHY START -->
<div id="bibliography" class="pb-2">
  <div class="">
    <h3>Bibliography</h3>
  </div>
  <div class="">
    
      <span id="bibliography-1" class="pr-2">1)</span> <span>Kocharians, N. and Paluch, P. (2014) CCIE Routing and Switching v5.0 Official Cert Guide, Volume 1, 5th Edition - Chapter 3: Spanning Tree Protocol. Indianapolis: Cisco Press</span><br>
    
      <span id="bibliography-2" class="pr-2">2)</span> <span>cisco.com (2006) Understanding and Tuning Spanning Tree Protocol Timers. Available at https://www.cisco.com/c/en/us/support/docs/lan-switching/spanning-tree-protocol/19120-122.html (Accessed: 20 Jul 2018)</span><br>
    
      <span id="bibliography-3" class="pr-2">3)</span> <span>cisco.com (2017) Understanding Rapid Spanning Tree Protocol (802.1w). Available at https://www.cisco.com/c/en/us/support/docs/lan-switching/spanning-tree-protocol/24062-146.html (Accessed: 25 Jul 2018)</span><br>
    
      <span id="bibliography-4" class="pr-2">4)</span> <span>cisco.com (2017) Understanding Multiple Spanning Tree Protocol (802.1s). Available at https://www.cisco.com/c/en/us/support/docs/lan-switching/spanning-tree-protocol/24248-147.html (Accessed: 01 Aug 2018)</span><br>
    
  </div>
</div>
<!-- TABLE BIBLIOGRAPHY END -->

  


            
  
    
  <!-- LINKS START -->
  <div class="pb-2">
    <h3 id="links">Links</h3>
      
        <p class="text-xl">
          <a class="text-sky-600 no-underline hover:text-sky-900" href="http://www.ieee802.org/1/pages/802.1D-2003.html" target=_blank>http://www.ieee802.org/1/pages/802.1D-2003.html</a>
        </p>
      
        <p class="text-xl">
          <a class="text-sky-600 no-underline hover:text-sky-900" href="http://www.ieee802.org/1/pages/802.1Q.html" target=_blank>http://www.ieee802.org/1/pages/802.1Q.html</a>
        </p>
      
  </div>
  <!-- LINKS END -->

  


            
  
    
<!-- TAGS START -->
  <div id="tags" class="pb-2">
    <div class="flex flex-wrap justify-center">
      
        <div class="pr-2 text-rose-700 hover:text-rose-900 font-semibold italic lowercase tracking-wide">
          <i class="-mr-1.5 text-2xl">#</i>
          <a href="/blog/tag/#networking" class="text-xl">networking</a>        
        </div>
      
        <div class="pr-2 text-rose-700 hover:text-rose-900 font-semibold italic lowercase tracking-wide">
          <i class="-mr-1.5 text-2xl">#</i>
          <a href="/blog/tag/#switching" class="text-xl">switching</a>        
        </div>
      
        <div class=" text-rose-700 hover:text-rose-900 font-semibold italic lowercase tracking-wide">
          <i class="-mr-1.5 text-2xl">#</i>
          <a href="/blog/tag/#protocols" class="text-xl">protocols</a>        
        </div>
      
    </div>
  </div>
<!-- TAGS END -->

  


            
  
<!-- BLANK PAGE START -->
<div id="blank-page">
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
</div>
<!-- BLANK PAGE END -->


          </div>
        </div>
        <!-- COLUMN 2 END -->

        <!-- COLUMN 3 START -->
        <div class="invisible md:visible md:col-span-3 max-h-screen sticky top-20">
          
  
    
<!-- TABLE OF CONTENTS START -->
<div id="table-of-contents" class="invisible md:visible h-4/5 overflow-y-auto">
  <div class="">
    <h5 class="">On this page</h5>
  </div>
  <div class="">
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#overview">
            Overview
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#stp">
            STP
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#rstp">
            RSTP
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#mstp">
            MSTP
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#packet-captures">
            Packet Captures
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#bibliography">
            Bibliography
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#links">
            Links
          </a>
        </div>
      
      
  </div>
</div>
<!-- TABLE OF CONTENTS END -->

  

        </div>
        <!-- COLUMN 3 END -->

      </div>
      <!-- CONTENT END -->

      <!-- BACK TO TOP START -->
<div id="back-to-top" class="hidden fixed bottom-20 right-16 rounded-full font-semibold text-zinc-900 bg-neutral-400 hover:bg-neutral-100">
  <button type="button" class="">
    <i class="fas fa-arrow-circle-up fa-3x"></i>
  </button>
</div>
<!-- BACK TO TOP END -->
    </div>
  
    <!-- FOOTER START -->
<div id="footer" class="fixed inset-x-0 bottom-0">
  <div class="flex justify-center w-full py-4 bg-zinc-900 shadow-lg">
    <div class="text-center">
      <a class="px-2 font-semibold text-neutral-400 hover:text-neutral-100" href="https://twitter.com/codingpackets" target="_blank"><i class="fab fa-twitter fa-2x"></i></a>
      <a class="px-2 font-semibold text-neutral-400 hover:text-neutral-100" href="https://www.twitch.tv/codingpackets" target="_blank"><i class="fab fa-twitch fa-2x"></i></a>
      <a class="px-2 font-semibold text-neutral-400 hover:text-neutral-100" href="https://github.com/bwks" target="_blank"><i class="fab fa-github fa-2x"></i></a>
      <a class="px-2 font-semibold text-neutral-400 hover:text-neutral-100" href="/blog/feed.xml" target="_blank"><i class="fa fa-rss fa-2x"></i></a>
    </div>
  </div>
</div>
<!-- FOOTER END -->

  </body>

</html>
