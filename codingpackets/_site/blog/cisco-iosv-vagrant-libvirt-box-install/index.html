



<!DOCTYPE html>
<html lang="en" class="dark scroll-smooth scroll-pt-[4.5rem]">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    
      <link rel="shortcut icon" href="/favicon/favicon.ico" type="image/x-icon">
    
    
    
      <link rel="stylesheet" href="/css/highlightjs/highlightjs-xt256.css">
      <link rel="stylesheet" href="/css/fontawesome/css/all.min.css">
    

    
      <link rel="stylesheet" href="/css/app.css">
    

    
      <script src="/js/highlightjs/highlightjs-11.5.0.min.js"></script>
      <script src="/js/highlightjs/terraform.js"></script>
      <script defer src="/js/fontawesome/js/all.js"></script>
    

    
      <script defer src="/js/custom/back-to-top.js"></script>
      <script defer src="/js/custom/light-switch.js"></script>
    

    
      <script>
        hljs.registerLanguage('terraform', window.hljsDefineTerraform);
        hljs.highlightAll();
      </script>
    

    
    

    <title>codingpackets.com</title>
  </head>

  <body class="bg-stone-50 dark:bg-black tracking-wide ">

    <!-- NAVBAR START -->
<nav id="navbar" class="w-full py-3 bg-zinc-900 text-xl shadow-lg fixed inset-x-0 top-0 z-50">
  <div class="flex justify-center items-center py-1">
    <div>
      <a class="text-neutral-400 hover:text-neutral-100 p-0" href="/">Me</a>
    </div>
    <div class="px-4">
      <p class="text-neutral-400 p-0">|</p>
    </div>
    <div>
      <a class="text-neutral-400 hover:text-neutral-100" href="/blog/">Blog</a>
    </div>
    <div class="px-4">
      <p class="text-neutral-400 p-0">|</p>
    </div>
    <div>
      <a class="text-neutral-400 hover:text-neutral-100" href="/blog/recent/">Recent</a>
    </div>
    <div class="px-4">
      <p class="text-neutral-400 p-0">|</p>
    </div>
    <div class="-mt-6 -ml-1">
      <labeL class="relative inline-block">
        <input type="checkbox" id="light-switch" class="opacity-0 w-0 h-0">
        <img id="light-bulb" class="opacity-90 hover:opacity-60 dark:opacity-60 dark:hover:opacity-100 p-0 w-7" src="/img/light-bulb-64-light.png" alt="on/off">
      </labeL>
    </div>
  </div>  
</nav>
<!-- NAVBAR END -->

    <div class="w-full">
      
  
    
<!-- PAGE HEADER START -->
<div class="grid grid-cols-12 gap-8">
  <div class="invisible md:visible md:col-span-3">
  </div>

  <div class="col-span-12 px-5 md:col-span-6">
    <div id="page-header" class="pt-20 -mb-4 pb-0 px-5 text-center sm:pb-4 sm:mb-0">
      <h1 class="pb-1 sm:pb-2">Cisco IOSv Vagrant Libvirt Box Install</h1>
      <div class="">
        
        
          <p class="text-neutral-500 dark:text-neutral-600 text-lg italic p-0">
            published: 7th of May 2018
          </p>
        
      </div>
    </div>
  </div>

  <div class="invisible md:visible md:col-span-3">
  </div>
</div>
<!-- PAGE HEADER END -->

  


      <!-- CONTENT START -->
      <div class="grid grid-cols-12 gap-8">

        <!-- COLUMN 1 START -->
        <div class="invisible md:visible md:col-span-3">
        </div>
        <!-- COLUMN 1 END -->

        <!-- COLUMN 2 START -->
        <div class="col-span-12 px-5 md:col-span-6">
          <div class="text-xl text-gray-800 dark:text-neutral-400 font-medium leading-relaxed md:leading-relaxed">
            

<h3 id="intro">Intro</h3>
<p>
  In this post I will cover how to create a Cisco IOSv Vagrant box for use with the
  <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">vagrant-libvirt</span>
 provider. This post assumes a
  working installation of Vagrant with the <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">vagrant-libvirt</span>
 plugin
  already installed. You can follow this
  <a class="text-sky-600 no-underline hover:text-sky-900" href="/blog/using-the-libvirt-provider-with-vagrant">post</a>
  to get the <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">vagrant-libvirt</span>
 plugin installed.
</p>



<!-- NOTE BLOCK START -->
<div id="note-block" class="pt-2 pb-4">
  <div class="shadow-md shadow-zinc-400 bg-sky-100 rounded border-l-8 border-l-sky-900 dark:border-l-sky-600 dark:bg-sky-800 dark:shadow-none">
    <div class="px-4 pt-4 pb-2 text-sky-900 dark:text-zinc-900"><i class="far fa-check-circle" aria-hidden="true"></i><b class="pl-1.5">Note</b></div>
    <div class="px-4 pb-4 dark:text-zinc-900">
    I am using an IOSv image that is available with a Cisco <a class="text-sky-600 no-underline hover:text-sky-900" href="http://virl.cisco.com/" target=_blank>VIRL</a>
    subscription. I do not know if the image is available without a VIRL subscription.
</div>
  </div>
</div>
<!-- NOTE BLOCK END -->


<p>
  For reference the following software will be used in this post.
</p>
<ul>
  <li><b>IOSv</b> - vios-adventerprisek9-m.vmdk.SPA.156-1.T</li>
  <li><b>Vagrant</b> - Vagrant 2.1.0</li>
  <li><b>vagrant-libvirt</b> - 0.0.43</li>
</ul>

<h3 id="download">Download</h3>
<p>
  Navigate to the Cisco software
  <a class="text-sky-600 no-underline hover:text-sky-900" href="https://software.cisco.com/download/home/286290254/type/286290305/release/IOSv" target=_blank>download</a>
 page
  and download the <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">vios-adventerprisek9-m.vmdk.SPA.156-1.T</span>

  image.
</p>

<h3 id="install">Install</h3>
<p>
  Create and change into directory for IOSv files. I like to keep my custom vagrant boxes under
  <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">~/vagrant/boxes/</span>
.
</p>


<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">cmd</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-text hljs px-5 dark:opacity-80 rounded-b">mkdir -p ~/vagrant/boxes/cisco/iosv
cd ~/vagrant/boxes/cisco/iosv</code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->



<p>
  Copy the iosv files downloaded earlier to the
  <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">~/vagrant/boxes/cisco/iosv/</span>
 directory.
</p>

<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">cmd</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-text hljs px-5 dark:opacity-80 rounded-b">cp ~/Downloads/vios-adventerprisek9-m.vmdk.SPA.156-1.T .</code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->



<p>
  The good folks who maintain the <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">vagrant-libvirt</span>
 plugin
  have a script can be used to convert <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">qcow2</span>
 images to a
  vagrant box. Download the libvirt convertsion script.
</p>

<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">cmd</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-text hljs px-5 dark:opacity-80 rounded-b">curl -O https://raw.githubusercontent.com/vagrant-libvirt/vagrant-libvirt/master/tools/create_box.sh</code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->



<p>
  Convert the <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">vmdk</span>
 disk to the
  <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">qcow2</span>
 format for use with KVM.
</p>


<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">cmd</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-text hljs px-5 dark:opacity-80 rounded-b">qemu-img convert -f vmdk -O qcow2 vios-adventerprisek9-m.vmdk.SPA.156-1.T iosv.qcow2</code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->



<p>
  Launch the Cisco IOSv VM in order to apply a bootstrap config to it that allows Vagrant to
  login and manage the box.
</p>

<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">cmd</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-xml hljs px-5 dark:opacity-80 rounded-b">virt-install \
    --connect=qemu:///system \
    --network network=vagrant-libvirt,model=e1000 \
    --name=iosv \
    --cpu host \
    --arch=x86_64 \
    --machine=pc-1.0 \
    --vcpus=1 \
    --ram=512 \
    --os-type=linux \
    --noacpi \
    --virt-type=kvm \
    --watchdog i6300esb,action=reset \
    --disk path=iosv.qcow2,format=qcow2,device=disk,bus=virtio,cache=writethrough \
    --graphics none \
    --import</code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->



<p>
  You will be connected to the console. Enter <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">no</span>
 when
  the highlighted section is presented.
</p>


<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">cmd</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-text hljs px-5 dark:opacity-80 rounded-b"># output

                             GNU GRUB  version 2.00

 +--------------------------------------------------------------------------+
 |                                                                          |
 |IOSv                                                                      |
 |                                                                          |
  Booting `IOSv'

error: Can't get controller info..
Booted IOSv. Boot args: [/vios-adventerprisek9-m]

Smart Init is enabled

&lt;snip&gt;
.
.
         --- System Configuration Dialog ---

Would you like to enter the initial configuration dialog? [yes/no]: no


Press RETURN to get started!
.
.
&lt;snip&gt;

Router></code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->



<p>
  Apply bootstrap configuration.
</p>

<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">cmd</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-text hljs px-5 dark:opacity-80 rounded-b">!
en
conf t
hostname iosv
!
ip domain-name lab.local
!
crypto key generate rsa modulus 2048
ip ssh version 2
!
aaa new-model
!
aaa authentication login default local
aaa authorization exec default local
!
username vagrant privilege 15 secret vagrant
!
ip ssh pubkey-chain
  username vagrant
    key-hash ssh-rsa DD3BB82E850406E9ABFFA80AC0046ED6
!
vrf definition MGMT
 description Management interface
 !
 address-family ipv4
 exit-address-family
!
interface GigabitEthernet0/0
  description vagrant-management
  vrf forwarding MGMT
  ip address dhcp
  duplex auto
  speed auto
  media-type rj45
  no shutdown
!
line vty 0 4
 transport input ssh
!
event manager applet ENABLE-MGMT
 event syslog pattern "SYS-5-RESTART"
 action 0 cli command "enable"
 action 1 cli command "conf t"
 action 2 cli command "crypto key generate rsa modulus 2048"
 action 3 cli command "interface GigabitEthernet0/0"
 action 4 cli command "no shutdown"
 action 5 cli command "exit"
!
end
wr mem
!</code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->



<p>
  This configuration allows Vagrant to assign an IP address to the management interface via
  DHCP and to also ssh to the guest using ssh keys. There is an EEM script
  <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">ENABLE-MGMT</span>
 that is required to generate the SSH keys and
  enable the management interface on boot.
</p>



<!-- IMPORTANT BLOCK START -->
<div id="important-block" class="pt-2 pb-4">
  <div class="shadow-md shadow-zinc-400 bg-amber-100 rounded border-l-8 border-amber-500/90 dark:bg-amber-700 dark:border-l-amber-500 dark:shadow-none">
    <div class="px-4 pt-4 pb-2 text-amber-500/90 dark:text-zinc-900"><i class="far fa-star" aria-hidden="true"></i><b class="pl-1.5">Important</b></div>
    <div class="px-4 pb-4 dark:text-zinc-900">
    Without the EEM script Vagrant will not be able to manage the box. The SSH keys are not
    preserved between reboots and the GigabitEthernet0/0 interface will be shutdown on boot,
    I think this is due to the MAC address changing.
</div>
  </div>
</div>
<!-- NOTE BLOCK END -->


<p>
  Check the IP address assigned via DHCP.
</p>

<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">cmd</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-text hljs px-5 dark:opacity-80 rounded-b">show ip int brie

# output

Interface                  IP-Address      OK? Method Status                Protocol
GigabitEthernet0/0         192.168.121.63  YES DHCP   up                    up</code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->



<p>
  From your host terminal confirm you can SSH to the Cisco IOSv VM with the vagrant SSH key.
</p>

<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">cmd</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-text hljs px-5 dark:opacity-80 rounded-b"># host terminal

ssh vagrant@192.168.121.63 -i ~/.vagrant.d/insecure_private_key

# now in IOSv VM

Warning: Permanently added '192.168.121.63' (RSA) to the list of known hosts.

**************************************************************************
* IOSv is strictly limited to use for evaluation, demonstration and IOS  *
* education. IOSv is provided as-is and is not supported by Cisco's      *
* Technical Advisory Center. Any use or disclosure, in whole or in part, *
* of the IOSv Software or Documentation to any third party for any       *
* purposes is expressly prohibited except as otherwise authorized by     *
* Cisco in writing.                                                      *
**************************************************************************

**************************************************************************
* IOSv is strictly limited to use for evaluation, demonstration and IOS  *
* education. IOSv is provided as-is and is not supported by Cisco's      *
* Technical Advisory Center. Any use or disclosure, in whole or in part, *
* of the IOSv Software or Documentation to any third party for any       *
* purposes is expressly prohibited except as otherwise authorized by     *
* Cisco in writing.                                                      *
**************************************************************************
iosv#exit
Connection to 192.168.121.63 closed.</code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->



<p>
  If you successfully connected, exit and power off the VM.
</p>
<p>
  To exit the console use one of these key combinations (Assuming English keyboard).
</p>
<ul>
  <li><kbd class="uppercase font-mono font-semibold py-0.5 px-2 rounded-lg bg-neutral-50 border border-b-4 border-x-4 border-neutral-400 border-r-neutral-500/75 border-b-neutral-500 dark:bg-neutral-300 dark:text-zinc-900">CTRL</kbd> + <kbd class="uppercase font-mono font-semibold py-0.5 px-2 rounded-lg bg-neutral-50 border border-b-4 border-x-4 border-neutral-400 border-r-neutral-500/75 border-b-neutral-500 dark:bg-neutral-300 dark:text-zinc-900">]</kbd></li>
  <li><kbd class="uppercase font-mono font-semibold py-0.5 px-2 rounded-lg bg-neutral-50 border border-b-4 border-x-4 border-neutral-400 border-r-neutral-500/75 border-b-neutral-500 dark:bg-neutral-300 dark:text-zinc-900">CTRL</kbd> + <kbd class="uppercase font-mono font-semibold py-0.5 px-2 rounded-lg bg-neutral-50 border border-b-4 border-x-4 border-neutral-400 border-r-neutral-500/75 border-b-neutral-500 dark:bg-neutral-300 dark:text-zinc-900">5</kbd></li>
  <li>Press and hold <kbd class="uppercase font-mono font-semibold py-0.5 px-2 rounded-lg bg-neutral-50 border border-b-4 border-x-4 border-neutral-400 border-r-neutral-500/75 border-b-neutral-500 dark:bg-neutral-300 dark:text-zinc-900">CTRL</kbd> and <kbd class="uppercase font-mono font-semibold py-0.5 px-2 rounded-lg bg-neutral-50 border border-b-4 border-x-4 border-neutral-400 border-r-neutral-500/75 border-b-neutral-500 dark:bg-neutral-300 dark:text-zinc-900">SHIFT</kbd> while pressing <kbd class="uppercase font-mono font-semibold py-0.5 px-2 rounded-lg bg-neutral-50 border border-b-4 border-x-4 border-neutral-400 border-r-neutral-500/75 border-b-neutral-500 dark:bg-neutral-300 dark:text-zinc-900">6</kbd> then <kbd class="uppercase font-mono font-semibold py-0.5 px-2 rounded-lg bg-neutral-50 border border-b-4 border-x-4 border-neutral-400 border-r-neutral-500/75 border-b-neutral-500 dark:bg-neutral-300 dark:text-zinc-900">]</kbd></li>
</ul>

<p>
  Now power off the VM.
</p>

<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">cmd</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-text hljs px-5 dark:opacity-80 rounded-b">virsh destroy iosv

# output

Domain iosv destroyed</code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->



<p>
  Create a file called <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">metadata.json</span>
 with the following contents.
</p>

<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">file</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-json hljs px-5 dark:opacity-80 rounded-b">{"provider":"libvirt","format":"qcow2","virtual_size":2}</code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->



<p>
  Use the previously downloaded script <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">create_box.sh</span>
 to
  create a vagrant box.
</p>

<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">cmd</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-text hljs px-5 dark:opacity-80 rounded-b">bash create_box.sh iosv.qcow2

# output

{2}
==> Creating box, tarring and gzipping
./metadata.json
./Vagrantfile
./box.img
Total bytes written: 123637760 (118MiB, 15MiB/s)
==> iosv.box created
==> You can now add the box:
==>   'vagrant box add iosv.box --name iosv'</code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->



<p>
  Create a metadata file called <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">iosv.json</span>
 so that the
  box is added with the correct version number.
</p>

<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">file</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-json hljs px-5 dark:opacity-80 rounded-b">{
  "name": "cisco/iosv",
  "description": "Cisco IOSv",
  "versions": [
    {
      "version": "15.6-1-T",
      "providers": [
        {
          "name": "libvirt",
          "url": "file:///home/bradmin/vagrant/boxes/cisco/iosv/iosv.box"
        }
      ]
    }
  ]
}</code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->




<p>
  Add the box to Vagrant.
</p>

<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">cmd</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-text hljs px-5 dark:opacity-80 rounded-b">vagrant box add iosv.json

# output

==> box: Loading metadata for box 'iosv.json'
    box: URL: file:///home/bradmin/vagrant/boxes/cisco/iosv/iosv.json
==> box: Adding box 'cisco/iosv' (v15.6-1-T) for provider: libvirt
    box: Unpacking necessary files from: file:///home/bradmin/vagrant/boxes/cisco/iosv/iosv.box
==> box: Successfully added box cisco/iosv' (v15.6-1-T) for 'libvirt'!</code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->



<p>
  Confirm the box was added successfully
</p>

<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">cmd</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-text hljs px-5 dark:opacity-80 rounded-b">vagrant box list

# output

CumulusCommunity/cumulus-vx          (libvirt, 3.4.2)
arista/veos                          (libvirt, 4.20.1F)
cisco/asav                           (virtualbox, 9.8.1)
cisco/csr1000v                       (libvirt, 03.15.00.S-155-2-S)
<span class="hljs-string">cisco/iosv                           (libvirt, 15.6-1-T)</span></code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->



<h3 id="testing">Testing</h3>
<p>
  Now that we have the box installed lets create a
  <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">Vagrantfile</span>
 and confirm we can build VM's with Vagrant.
</p>

<p>
  Create a test directory.
</p>

<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">cmd</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-text hljs px-5 dark:opacity-80 rounded-b">mkdir ~/iosv-test
cd ~/iosv-test</code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->



<p>
  Add a <span class="px-2 py-1 font-mono font-semibold rounded bg-sky-50 text-sky-900 border border-sky-200/50 dark:bg-zinc-900 dark:text-neutral-400 dark:border-zinc-800">Vagrantfile</span>
 to the test directory with the
  following contents
</p>

<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">file</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-ruby hljs px-5 dark:opacity-80 rounded-b"># -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|
  config.vm.define "rt01" do |node|
    node.vm.box = "cisco/iosv"

    # Turn off shared folders
    node.vm.synced_folder ".", "/vagrant", disabled: true

    # Do not try to insert new SSH key
    node.ssh.insert_key = false

    # Give VM time to boot
    node.vm.boot_timeout = 180

    # Set guest type to prevent guest type detection
    node.vm.guest = :freebsd

    # Provider-specific configuration
    node.vm.provider :libvirt do |domain|
      domain.nic_adapter_count = 8
      domain.memory = 512
      domain.cpus = 1
      domain.driver = "kvm"
      domain.nic_model_type = "e1000"
    end

  end
end</code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->



<p>
  Now <span class="px-2 py-1 font-mono font-semibold rounded bg-zinc-900 border border-zinc-800 text-emerald-400 dark:text-emerald-700">vagrant up</span>
 and confirm you can login.
</p>

<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">cmd</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-text hljs px-5 dark:opacity-80 rounded-b">vagrant up

# output

Bringing machine 'rt01' up with 'libvirt' provider...
==> rt01: Checking if box 'cisco/iosv' is up to date...
==> rt01: Creating image (snapshot of base box volume).
==> rt01: Creating domain with the following settings...
==> rt01:  -- Name:              iosv_rt01
==> rt01:  -- Domain type:       kvm
==> rt01:  -- Cpus:              1
==> rt01:
==> rt01:  -- Feature:           acpi
==> rt01:  -- Feature:           apic
==> rt01:  -- Feature:           pae
==> rt01:  -- Memory:            512M
==> rt01:  -- Management MAC:
==> rt01:  -- Loader:
==> rt01:  -- Base box:          cisco/iosv
==> rt01:  -- Storage pool:      default
==> rt01:  -- Image:             /var/lib/libvirt/images/iosv_rt01.img (2G)
==> rt01:  -- Volume Cache:      default
==> rt01:  -- Kernel:
==> rt01:  -- Initrd:
==> rt01:  -- Graphics Type:     vnc
==> rt01:  -- Graphics Port:     -1
==> rt01:  -- Graphics IP:       127.0.0.1
==> rt01:  -- Graphics Password: Not defined
==> rt01:  -- Video Type:        cirrus
==> rt01:  -- Video VRAM:        9216
==> rt01:  -- Sound Type:
==> rt01:  -- Keymap:            en-us
==> rt01:  -- TPM Path:
==> rt01:  -- INPUT:             type=mouse, bus=ps2
==> rt01: Creating shared folders metadata...
==> rt01: Starting domain.
==> rt01: Waiting for domain to get an IP address...
==> rt01: Waiting for SSH to become available...
==> rt01: Configuring and enabling network interfaces...</code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->



<p>Confirm you can login to the box.</p>

<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">cmd</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-text hljs px-5 dark:opacity-80 rounded-b"># Host terminal

vagrant ssh

# Now in vagrant box terminal

**************************************************************************
* IOSv is strictly limited to use for evaluation, demonstration and IOS  *
* education. IOSv is provided as-is and is not supported by Cisco's      *
* Technical Advisory Center. Any use or disclosure, in whole or in part, *
* of the IOSv Software or Documentation to any third party for any       *
* purposes is expressly prohibited except as otherwise authorized by     *
* Cisco in writing.                                                      *
**************************************************************************

iosv#show version
Cisco IOS Software, IOSv Software (VIOS-ADVENTERPRISEK9-M), Version 15.6(1)T, RELEASE SOFTWARE (fc1)
Technical Support: http://www.cisco.com/techsupport
Copyright (c) 1986-2015 by Cisco Systems, Inc.
Compiled Fri 20-Nov-15 13:39 by prod_rel_team


ROM: Bootstrap program is IOSv

iosv uptime is 1 minute
System returned to ROM by reload
System image file is "flash0:/vios-adventerprisek9-m"
Last reload reason: Unknown reason



This product contains cryptographic features and is subject to United
States and local country laws governing import, export, transfer and
use. Delivery of Cisco cryptographic products does not imply
third-party authority to import, export, distribute or use encryption.
Importers, exporters, distributors and users are responsible for
compliance with U.S. and local country laws. By using this product you
agree to comply with applicable laws and regulations. If you are unable
to comply with U.S. and local laws, return this product immediately.

A summary of U.S. laws governing Cisco cryptographic products may be found at:
http://www.cisco.com/wwl/export/crypto/tool/stqrg.html

If you require further assistance please contact us by sending email to
export@cisco.com.

Cisco IOSv (revision 1.0) with  with 496897K/25600K bytes of memory.
Processor board ID 9YGHKHUSEIFBLTHVGUKBJ
1 Gigabit Ethernet interface
DRAM configuration is 72 bits wide with parity disabled.
256K bytes of non-volatile configuration memory.
2097152K bytes of ATA System CompactFlash 0 (Read/Write)
0K bytes of ATA CompactFlash 1 (Read/Write)
0K bytes of ATA CompactFlash 2 (Read/Write)
0K bytes of ATA CompactFlash 3 (Read/Write)



Configuration register is 0x0

iosv#</code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->



<p>
  Awesome, we can build and login to the box with Vagrant. Lastly, let clean up a bit.
</p>

<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">cmd</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-text hljs px-5 dark:opacity-80 rounded-b"># back in host shell

vagrant destroy -f

# output

==> rt01: Removing domain...</code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->



<p>Remove the original KVM image.</p>

<!-- CODE BLOCK START -->
<div id="code-block" class="pt-2 pb-4">
  <div class="rounded-lg border-4 border-zinc-900 shadow-md shadow-zinc-400 dark:shadow-none">
    <div class="py-1 text-center font-bold font-mono border-b-4 border-zinc-900">
      <span class="">cmd</span>
    </div>
    <div class="font-mono">
      <pre><code class="language-text hljs px-5 dark:opacity-80 rounded-b">rm -f iosv.qcow2
virsh undefine iosv

# output

Domain iosv has been undefined</code></pre>
    </div>
  </div>
</div>
<!-- CODE BLOCK END -->




<h3 id="outro">Outro</h3>
<p>
  Compared to the CSR1000v the IOSv image is more lightweight, it requires much less
  resources and is a lot faster to boot up. Now that you have an IOSv image in your
  Vagrant arsenal go out and give your old pal Cisco some network automation love.
</p>



            
  


            
  


            
  
    
  <!-- LINKS START -->
  <div class="pb-2">
    <h3 id="links">Links</h3>
      
        <p class="text-xl">
          <a class="text-sky-600 no-underline hover:text-sky-900" href="https://supportforums.cisco.com/t5/network-infrastructure-documents/how-to-run-an-eem-policy-every-time-a-device-boots/ta-p/3125945" target=_blank>https://supportforums.cisco.com/t5/network-infrastructure-documents/how-to-run-an-eem-policy-every-time-a-device-boots/ta-p/3125945</a>
        </p>
      
  </div>
  <!-- LINKS END -->

  


            
  
    
<!-- TAGS START -->
  <div id="tags" class="pb-2">
    <div class="flex flex-wrap justify-center">
      
        <div class="pr-2 text-rose-700 hover:text-rose-900 font-semibold italic lowercase tracking-wide">
          <i class="-mr-1.5 text-2xl">#</i>
          <a href="/blog/tag/#vagrant" class="text-xl">vagrant</a>        
        </div>
      
        <div class="pr-2 text-rose-700 hover:text-rose-900 font-semibold italic lowercase tracking-wide">
          <i class="-mr-1.5 text-2xl">#</i>
          <a href="/blog/tag/#cisco" class="text-xl">cisco</a>        
        </div>
      
        <div class=" text-rose-700 hover:text-rose-900 font-semibold italic lowercase tracking-wide">
          <i class="-mr-1.5 text-2xl">#</i>
          <a href="/blog/tag/#libvirt" class="text-xl">libvirt</a>        
        </div>
      
    </div>
  </div>
<!-- TAGS END -->

  


            
  
<!-- BLANK PAGE START -->
<div id="blank-page">
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
    <br>
  
</div>
<!-- BLANK PAGE END -->


          </div>
        </div>
        <!-- COLUMN 2 END -->

        <!-- COLUMN 3 START -->
        <div class="invisible md:visible md:col-span-3 max-h-screen sticky top-20">
          
  
    
<!-- TABLE OF CONTENTS START -->
<div id="table-of-contents" class="invisible md:visible h-4/5 overflow-y-auto">
  <div class="">
    <h5 class="">On this page</h5>
  </div>
  <div class="">
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#intro">
            Intro
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#download">
            Download
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#install">
            Install
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#testing">
            Testing
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#outro">
            Outro
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#links">
            Links
          </a>
        </div>
      
    
      
        <div class="px-1">
          <a class="text-sky-600 font-normal text-xl no-underline hover:text-sky-800" href="#tags">
            Tags
          </a>
        </div>
      
      
  </div>
</div>
<!-- TABLE OF CONTENTS END -->

  

        </div>
        <!-- COLUMN 3 END -->

      </div>
      <!-- CONTENT END -->

      <!-- BACK TO TOP START -->
<div id="back-to-top" class="hidden fixed bottom-20 right-16 rounded-full font-semibold text-zinc-900 bg-neutral-400 hover:bg-neutral-100">
  <button type="button" class="">
    <i class="fas fa-arrow-circle-up fa-3x"></i>
  </button>
</div>
<!-- BACK TO TOP END -->
    </div>
  
    <!-- FOOTER START -->
<div id="footer" class="fixed inset-x-0 bottom-0">
  <div class="flex justify-center w-full py-4 bg-zinc-900 shadow-lg">
    <div class="text-center">
      <a class="px-2 font-semibold text-neutral-400 hover:text-neutral-100" href="https://twitter.com/codingpackets" target="_blank"><i class="fab fa-twitter fa-2x"></i></a>
      <a class="px-2 font-semibold text-neutral-400 hover:text-neutral-100" href="https://www.twitch.tv/codingpackets" target="_blank"><i class="fab fa-twitch fa-2x"></i></a>
      <a class="px-2 font-semibold text-neutral-400 hover:text-neutral-100" href="https://github.com/bwks" target="_blank"><i class="fab fa-github fa-2x"></i></a>
      <a class="px-2 font-semibold text-neutral-400 hover:text-neutral-100" href="/blog/feed.xml" target="_blank"><i class="fa fa-rss fa-2x"></i></a>
    </div>
  </div>
</div>
<!-- FOOTER END -->

  </body>

</html>
